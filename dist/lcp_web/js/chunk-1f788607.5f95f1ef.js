(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-1f788607"],{2283:function(t,e,i){"use strict";i.r(e);var a=(i("5df3"),i("4f7f"),i("c7eb")),n=(i("96cf"),i("1da1")),s=(i("ac6a"),i("aef6"),i("6ea4")),r=i("ed08"),o=i("7a3a"),l=i("b775"),c=i("2687"),u={name:"SubmitReview",components:{Steps:s.a},data:function(){var t=function(t,e,i){e<=0?i(new Error("数值必须大于0")):e>1e8?i(new Error("数值必须小于100000000")):i()};return{loading:!0,unitId:0,status:0,steps:{active:0,tiptitleList:[]},table:{tableData:[],columnList:[],columnList1:[{label:"接口",prop:"apiCode"},{label:"中文名称",prop:"apiName"},{label:"URL",prop:"apiUrl"},{label:"每秒调用峰值预估",prop:"tps",fixed:"right"},{label:"每日调用总量预估",prop:"dailyCall",fixed:"right"}],columnList2:[{label:"SDK名称",prop:"name"},{label:"语言",prop:"language"},{label:"版本",prop:"version"},{label:"描述",prop:"remark"},{label:"SDK文件",prop:"fileName"},{label:"创建时间",prop:"uploadTime"}],ruleTable:{tps:[{required:!0,message:"请输入预估峰值"},{type:"number",message:"数值必须为数字类型"},{validator:t}],dailyCall:[{required:!0,message:"请输入预估总量"},{type:"number",message:"数值必须为数字类型"},{validator:t}]},formatTable:{language:["","JAVA",".NET","PHP"]}},submitReviewDebounceTimer:null,submitReviewButtonLoading:!1,isFirstPublishFlag:!0,modifyRecords:[],modifyRecordsAll:[],updateUserList:[],listQuery:{updateUser:"",updateTime:""},pickerOptions:{shortcuts:[{text:"最近三天",onClick:function(t){var e=new Date,i=new Date;i.setTime(i.getTime()-2592e5),t.$emit("pick",[i,e])}},{text:"最近七天",onClick:function(t){var e=new Date,i=new Date;i.setTime(i.getTime()-6048e5),t.$emit("pick",[i,e])}},{text:"最近三十天",onClick:function(t){var e=new Date,i=new Date;i.setTime(i.getTime()-2592e6),t.$emit("pick",[i,e])}}]},types:{BASE:"概要",INNER_CALL_OUTER:"内调外接口",OUTER_CALL_INNER:"外调内接口",MSG:"消息"},tableLoading:!1}},computed:{computeTableMaxHeight:function(){return document.body.offsetHeight-300}},methods:{formatType:function(t,e,i,a){return this.types[i]},formatText:function(t,e){return e?"language"===t?this.table.formatTable.language[e]:t.endsWith("Time")?Object(r.c)(e,"{y}-{m}-{d} {h}:{i}"):e:"-"},switchTable:function(t,e,i){this.steps.active=this.steps.active+t,this.table.tableData=e,this.table.columnList=i,this.loading=!1},onClickSubmitReviewButton:function(){var t=this;clearTimeout(this.submitReviewDebounceTimer),this.submitReviewDebounceTimer=setTimeout((function(){t.submitReviewButtonLoading=!0,Object(l.a)({url:"/bizunit/publishBizPreUnit",method:"get",params:{id:t.unitId}}).then((function(e){2e4===e.code&&(o.Message.success("操作成功"),t.steps.active+=1),t.submitReviewButtonLoading=!1})).catch((function(e){t.submitReviewButtonLoading=!1}))}),300)},previousStep:function(){this.postInterfaceListData(-1)},nextStep:function(t){if(this.table.tableData&&this.table.tableData.length>0){var e=0;this.$refs[t].forEach((function(t){t.validate((function(t){if(!t)return"".concat(e+=1," errors submit!!"),!1}))})),e||this.postSaveCallInfoData()}else this.postSdkListData()},postSdkListData:function(){var t=this;Object(l.a)({url:"/sdk/getSdkVOList",method:"post",data:this.unitId,headers:{"Content-Type":"application/json"}}).then((function(e){t.switchTable(1,e.data,t.table.columnList2)})).catch((function(t){}))},postSaveCallInfoData:function(){var t=this,e=this.table.tableData.map((function(t){return{id:t.id,tps:t.tps,dailyCall:t.dailyCall}})),i=this.unitId;Object(l.a)({url:"/bizapinterface/saveCallInfo",method:"post",data:{infoList:e,unitId:i}}).then((function(e){t.postSdkListData()})).catch((function(t){}))},postInterfaceListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.loading=!0,Object(l.a)({url:"/bizapinterface/queryInterfaceList",method:"get",params:{pageSize:9999,pageNumb:1,orderBy:"update_time",orderType:"desc",unitId:this.unitId}}).then((function(i){t.switchTable(e,i.data.list,t.table.columnList1)})).catch((function(t){}))},goToOpenBiz:function(){this.$router.push({name:"OpenBizOpenBizDetail",params:{id:this.unitId}})},goback:function(){this.$router.back()},isFirstPublish:function(){var t=Object(n.a)(Object(a.a)().mark((function t(){var e,i;return Object(a.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,c.a.isFirstPublish(this.unitId);case 3:if(e=t.sent,i=e.data,this.isFirstPublishFlag=i,!this.isFirstPublishFlag){t.next=10;break}this.steps.tiptitleList=["确认接口信息","确认SDK信息","完成"],t.next=13;break;case 10:return this.steps.tiptitleList=["检查修改记录","确认接口信息","确认SDK信息","完成"],t.next=13,this.getModifyRecords();case 13:t.next=18;break;case 15:throw t.prev=15,t.t0=t.catch(0),new Error("isFirstPublish: "+t.t0);case 18:case"end":return t.stop()}}),t,this,[[0,15]])})));return function(){return t.apply(this,arguments)}}(),getModifyRecords:function(){var t=Object(n.a)(Object(a.a)().mark((function t(){var e,i,n;return Object(a.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,this.tableLoading=!0,t.next=4,c.a.getModifyRecords(this.unitId);case 4:e=t.sent,i=e.data,0===this.updateUserList.length&&(n=new Set,this.updateUserList=i.reduce((function(t,e){return n.has(e.updateUser)||(n.add(e.updateUser),t.push(e)),t}),[])),this.modifyRecords=i,this.modifyRecordsAll=i,this.tableLoading=!1,t.next=16;break;case 12:throw t.prev=12,t.t0=t.catch(0),this.tableLoading=!1,new Error("getModifyRecords: "+t.t0);case 16:case"end":return t.stop()}}),t,this,[[0,12]])})));return function(){return t.apply(this,arguments)}}(),search:function(t,e){this.modifyRecords=t||e?this.modifyRecordsAll.filter((function(i){var a=new Date(i.updateTime).getTime();return(!t||t===i.updateUser)&&(!e||a>=e[0]&&a<=e[1])})):this.modifyRecordsAll}},created:function(){var t=this;this.loading=!0,this.unitId=this.$route.params.id,this.status=this.$route.query.status;var e={id:this.unitId};this.isFirstPublish(),Object(l.a)({url:"/bizunit/canPublish",method:"get",params:e}).then((function(e){2e4===e.code&&t.postInterfaceListData()})).catch((function(t){}))}},p=u,d=(i("4a35"),i("2877")),f=Object(d.a)(p,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"app-container"},[i("div",{staticClass:"submitReview"},[i("div",{staticClass:"header"},[i("el-button",{attrs:{icon:"el-icon-arrow-left"},on:{click:t.goback}},[t._v("返回")]),i("Steps",{attrs:{active:t.steps.active,tiptitle:t.steps.tiptitleList}})],1),i("div",{staticClass:"main"},[t.isFirstPublishFlag||0!==t.steps.active?!t.isFirstPublishFlag&&t.steps.active<3||t.isFirstPublishFlag&&t.steps.active<2?i("el-table",{ref:"table",attrs:{data:t.table.tableData,"max-height":t.computeTableMaxHeight,"hide-empty-img":!0}},[i("el-table-column",{attrs:{label:"序号",type:"index",align:"center"}}),t._l(t.table.columnList,(function(e,a){return i("el-table-column",{key:a,attrs:{label:e.label,prop:e.prop,fixed:e.fixed,align:"center"},scopedSlots:t._u([{key:"default",fn:function(a){var n=a.row;return["tps"===e.prop||"dailyCall"===e.prop?i("el-form",{ref:"ruleForm",refInFor:!0,attrs:{model:n,rules:t.table.ruleTable}},["tps"===e.prop?i("el-form-item",{attrs:{prop:"tps"}},[i("el-input",{attrs:{placeholder:"请输入预估峰值"},model:{value:n.tps,callback:function(e){t.$set(n,"tps",t._n(e))},expression:"row.tps"}})],1):i("el-form-item",{attrs:{prop:"dailyCall"}},[i("el-input",{attrs:{placeholder:"请输入预估总量"},model:{value:n.dailyCall,callback:function(e){t.$set(n,"dailyCall",t._n(e))},expression:"row.dailyCall"}})],1)],1):i("span",[t._v(t._s(t.formatText(e.prop,n[e.prop])))])]}}],null,!0)})}))],2):i("div",{staticClass:"submitSuccess"},[i("i",{staticClass:"el-icon-success"}),i("p",{staticClass:"title"},[t._v("提交成功")]),t._m(0)]):i("div",[i("el-row",{staticClass:"filter-container",attrs:{type:"flex",justify:"space-between"}},[i("el-form",{staticClass:"search-form",staticStyle:{height:"32px"},attrs:{inline:!0,model:t.listQuery},nativeOn:{submit:function(t){t.preventDefault()}}},[i("el-form-item",{attrs:{label:"最后一次修改人"}},[i("el-select",{staticStyle:{width:"100%"},attrs:{clearable:"",placeholder:"请选择修改人erp"},model:{value:t.listQuery.updateUser,callback:function(e){t.$set(t.listQuery,"updateUser",e)},expression:"listQuery.updateUser"}},t._l(t.updateUserList,(function(t){return i("el-option",{key:t.updateUser,attrs:{label:t.updateUser,value:t.updateUser}})})),1)],1),i("el-form-item",{attrs:{label:"修改时间",prop:"timeRange"}},[i("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"datetimerange","picker-options":t.pickerOptions,"range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","default-time":["00:00:00","23:59:59"]},model:{value:t.listQuery.updateTime,callback:function(e){t.$set(t.listQuery,"updateTime",e)},expression:"listQuery.updateTime"}})],1),i("el-form-item",[i("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:function(e){return t.search(t.listQuery.updateUser,t.listQuery.updateTime)}}},[t._v("查询")])],1)],1)],1),i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.tableLoading,expression:"tableLoading"}],attrs:{data:t.modifyRecords}},[i("el-table-column",{attrs:{label:"变更类型",prop:"type",width:"140px",formatter:t.formatType}}),i("el-table-column",{attrs:{label:"接口",prop:"metaDataMark"}}),i("el-table-column",{attrs:{label:"配置项",prop:"key"}}),i("el-table-column",{attrs:{label:"上次方案发布内容",prop:"oldValue"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("div",{domProps:{innerHTML:t._s(e.row.oldValue)}})]}}],null,!1,2454111192)}),i("el-table-column",{attrs:{label:"新内容"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("div",{domProps:{innerHTML:t._s(e.row.newValue)}})]}}],null,!1,898447299)}),i("el-table-column",{attrs:{label:"最后一次修改人",prop:"updateUser",width:"140px"}}),i("el-table-column",{attrs:{label:"修改时间",prop:"updateTime",width:"160px"}})],1)],1)],1),i("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"footer"},[t.isFirstPublishFlag?[1===t.steps.active?i("el-button",{on:{click:t.previousStep}},[t._v("上一步")]):t._e(),0===t.steps.active?i("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.nextStep("ruleForm")}}},[t._v("下一步")]):1===t.steps.active?i("el-button",{attrs:{type:"primary",loading:t.submitReviewButtonLoading},on:{click:t.onClickSubmitReviewButton}},[t._v("提交审核")]):2===t.steps.active?i("el-button",{attrs:{type:"primary"},on:{click:t.goToOpenBiz}},[t._v("继续管理")]):t._e()]:[1===t.steps.active?i("el-button",{on:{click:function(e){t.steps.active=0}}},[t._v("上一步")]):t._e(),2===t.steps.active?i("el-button",{on:{click:t.previousStep}},[t._v("上一步")]):t._e(),0===t.steps.active?i("el-button",{attrs:{type:"primary"},on:{click:function(e){t.steps.active=1}}},[t._v("下一步")]):t._e(),1===t.steps.active?i("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.nextStep("ruleForm")}}},[t._v("下一步")]):2===t.steps.active?i("el-button",{attrs:{type:"primary",loading:t.submitReviewButtonLoading},on:{click:t.onClickSubmitReviewButton}},[t._v("提交审核")]):3===t.steps.active?i("el-button",{attrs:{type:"primary"},on:{click:t.goToOpenBiz}},[t._v("继续管理")]):t._e()],i("div",{staticClass:"el-loading-mask",staticStyle:{display:"none"}})],2)])])}),[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"mainContain"},[i("p",{staticClass:"msgForfix"},[t._v(" 您可以前往京me—流程中心(PC端为"),i("a",{attrs:{href:"http://oa.jd.com/",target:"_blank"}},[t._v("oa.jd.com")]),t._v(")—我的申请，查看对接方案审批进度。 ")]),i("p",{staticClass:"msgForfix",staticStyle:{"text-align":"center"}},[t._v(" 注：审核通过后，需要手动点击【发布】按钮，才会将对接方案更新至前台。 ")])])}],!1,null,"1addab42",null);e.default=f.exports},"49aa":function(t,e,i){},"4a35":function(t,e,i){"use strict";i("49aa")},"4f7f":function(t,e,i){"use strict";var a=i("c26b"),n=i("b39a9");t.exports=i("e0b8")("Set",(function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}}),{add:function(t){return a.def(n(this,"Set"),t=0===t?0:t,t)}},a)},"5df3":function(t,e,i){"use strict";var a=i("02f4")(!0);i("01f9")(String,"String",(function(t){this._t=String(t),this._i=0}),(function(){var t,e=this._t,i=this._i;return i>=e.length?{value:void 0,done:!0}:(t=a(e,i),this._i+=t.length,{value:t,done:!1})}))},"67ab":function(t,e,i){var a=i("ca5a")("meta"),n=i("d3f4"),s=i("69a8"),r=i("86cc").f,o=0,l=Object.isExtensible||function(){return!0},c=!i("79e5")((function(){return l(Object.preventExtensions({}))})),u=function(t){r(t,a,{value:{i:"O"+ ++o,w:{}}})},p=t.exports={KEY:a,NEED:!1,fastKey:function(t,e){if(!n(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!s(t,a)){if(!l(t))return"F";if(!e)return"E";u(t)}return t[a].i},getWeak:function(t,e){if(!s(t,a)){if(!l(t))return!0;if(!e)return!1;u(t)}return t[a].w},onFreeze:function(t){return c&&p.NEED&&l(t)&&!s(t,a)&&u(t),t}}},"6ea4":function(t,e,i){"use strict";var a=(i("c5f6"),{name:"steps",props:{active:{required:!0,type:Number},title:{required:!1,type:String},tiptitle:{required:!0,type:Array}}}),n=(i("e7be"),i("2877")),s=Object(n.a)(a,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[t.title?i("h2",{staticClass:"com-tit-mini"},[t._v(t._s(t.title))]):t._e(),i("div",{staticClass:"my-step-bar"},[i("el-steps",{staticClass:"my-steps",attrs:{active:t.active,"finish-status":"success","align-center":""}},t._l(t.tiptitle,(function(t,e){return i("el-step",{key:e,attrs:{title:t}})})),1)],1)])}),[],!1,null,"16bbb482",null);e.a=s.exports},aef6:function(t,e,i){"use strict";var a=i("5ca1"),n=i("9def"),s=i("d2c8"),r="endsWith",o=""[r];a(a.P+a.F*i("5147")(r),"String",{endsWith:function(t){var e=s(this,t,r),i=arguments.length>1?arguments[1]:void 0,a=n(e.length),l=void 0===i?a:Math.min(n(i),a),c=String(t);return o?o.call(e,c,l):e.slice(l-c.length,l)===c}})},b39a9:function(t,e,i){var a=i("d3f4");t.exports=function(t,e){if(!a(t)||t._t!==e)throw TypeError("Incompatible receiver, "+e+" required!");return t}},c26b:function(t,e,i){"use strict";var a=i("86cc").f,n=i("2aeb"),s=i("dcbc"),r=i("9b43"),o=i("f605"),l=i("4a59"),c=i("01f9"),u=i("d53b"),p=i("7a56"),d=i("9e1e"),f=i("67ab").fastKey,b=i("b39a9"),h=d?"_s":"size",m=function(t,e){var i,a=f(e);if("F"!==a)return t._i[a];for(i=t._f;i;i=i.n)if(i.k==e)return i};t.exports={getConstructor:function(t,e,i,c){var u=t((function(t,a){o(t,u,e,"_i"),t._t=e,t._i=n(null),t._f=void 0,t._l=void 0,t[h]=0,null!=a&&l(a,i,t[c],t)}));return s(u.prototype,{clear:function(){for(var t=b(this,e),i=t._i,a=t._f;a;a=a.n)a.r=!0,a.p&&(a.p=a.p.n=void 0),delete i[a.i];t._f=t._l=void 0,t[h]=0},delete:function(t){var i=b(this,e),a=m(i,t);if(a){var n=a.n,s=a.p;delete i._i[a.i],a.r=!0,s&&(s.n=n),n&&(n.p=s),i._f==a&&(i._f=n),i._l==a&&(i._l=s),i[h]--}return!!a},forEach:function(t){b(this,e);for(var i,a=r(t,arguments.length>1?arguments[1]:void 0,3);i=i?i.n:this._f;)for(a(i.v,i.k,this);i&&i.r;)i=i.p},has:function(t){return!!m(b(this,e),t)}}),d&&a(u.prototype,"size",{get:function(){return b(this,e)[h]}}),u},def:function(t,e,i){var a,n,s=m(t,e);return s?s.v=i:(t._l=s={i:n=f(e,!0),k:e,v:i,p:a=t._l,n:void 0,r:!1},t._f||(t._f=s),a&&(a.n=s),t[h]++,"F"!==n&&(t._i[n]=s)),t},getEntry:m,setStrong:function(t,e,i){c(t,e,(function(t,i){this._t=b(t,e),this._k=i,this._l=void 0}),(function(){for(var t=this,e=t._k,i=t._l;i&&i.r;)i=i.p;return t._t&&(t._l=i=i?i.n:t._t._f)?u(0,"keys"==e?i.k:"values"==e?i.v:[i.k,i.v]):(t._t=void 0,u(1))}),i?"entries":"values",!i,!0),p(e)}}},d6a5:function(t,e,i){},e0b8:function(t,e,i){"use strict";var a=i("7726"),n=i("5ca1"),s=i("2aba"),r=i("dcbc"),o=i("67ab"),l=i("4a59"),c=i("f605"),u=i("d3f4"),p=i("79e5"),d=i("5cc5"),f=i("7f20"),b=i("5dbc");t.exports=function(t,e,i,h,m,v){var g=a[t],y=g,_=m?"set":"add",k=y&&y.prototype,w={},x=function(t){var e=k[t];s(k,t,"delete"==t||"has"==t?function(t){return!(v&&!u(t))&&e.call(this,0===t?0:t)}:"get"==t?function(t){return v&&!u(t)?void 0:e.call(this,0===t?0:t)}:"add"==t?function(t){return e.call(this,0===t?0:t),this}:function(t,i){return e.call(this,0===t?0:t,i),this})};if("function"==typeof y&&(v||k.forEach&&!p((function(){(new y).entries().next()})))){var S=new y,T=S[_](v?{}:-0,1)!=S,C=p((function(){S.has(1)})),L=d((function(t){new y(t)})),D=!v&&p((function(){for(var t=new y,e=5;e--;)t[_](e,e);return!t.has(-0)}));L||(y=e((function(e,i){c(e,y,t);var a=b(new g,e,y);return null!=i&&l(i,m,a[_],a),a})),y.prototype=k,k.constructor=y),(C||D)&&(x("delete"),x("has"),m&&x("get")),(D||T)&&x(_),v&&k.clear&&delete k.clear}else y=h.getConstructor(e,t,m,_),r(y.prototype,i),o.NEED=!0;return f(y,t),w[t]=y,n(n.G+n.W+n.F*(y!=g),w),v||h.setStrong(y,t,m),y}},e7be:function(t,e,i){"use strict";i("d6a5")}}]);