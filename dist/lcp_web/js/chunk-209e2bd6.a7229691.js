(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-209e2bd6"],{"0be6":function(e,t,r){},"0e07":function(e,t,r){"use strict";var a=r("7aef"),i=r("7562"),n=(r("b775"),{queryList:function(e){return i.a.post("/ApiManagerService/queryCloudClusterList",[e])},cloudClusterSave:function(e){return i.a.post("/ApiManagerService/saveCloudCluster",[e])},cloudClusterUpdate:function(e){return i.a.post("/ApiManagerService/updateCloudCluster",[e])},findUser:function(e){return a.a.get("/hrInfo/findUser",{params:e})},findSupplierUserByErp:function(e){return a.a.get("/supplier/findSupplierUserByErp",{params:e})},saveBaseInfo:function(e){return i.a.post("/HttpApiService/saveBaseInfo",[e])},queryApiReleaseByCondition:function(e){return i.a.post("/ApiDepotService/queryApiReleaseByCondition",JSON.stringify(e))},queryAliasByInterface:function(e){return i.a.post("/JsfApiMetaService/queryAliasByInterface",JSON.stringify(e))},getMethodList:function(e){return i.a.post("/ApiDepotService/queryApiReleaseByCondition",JSON.stringify(e))},queryMethodByInterface:function(e){return i.a.post("/JsfApiMetaService/queryMethodByInterface",JSON.stringify(e))},getSensitiveLabelForest:function(){return i.a.post("/HttpApiService/querySensitiveLabelForest")}});t.a=n},"15d6":function(e,t,r){},1667:function(e,t,r){"use strict";r("7aef");var a=r("7562"),i=r("0e07"),n=r("3342"),s={getApi:function(e){return a.a.post("/HttpApiService/findApi",e)},verifyApiSummaryFull:function(e){return a.a.post("/HttpApiService/verifyPublishApi",e)},postApi:function(e){return a.a.post("/HttpApiService/publishApi",[e])},updateApiDoc:function(e){return a.a.post("/ApiManagerService/updateApiDoc",JSON.stringify(e))},quickMaintainApiDocByXml:function(e){return a.a.post("/ApiManagerService/quickMaintainApiDocByXml",JSON.stringify(e))},quickMaintainApiDocByJson:function(e){return a.a.post("/ApiManagerService/quickMaintainApiDocByJson",JSON.stringify(e))},basicInfo:i.a,apiDoc:n.a};t.a=s},"2f6a":function(e,t,r){},"328c":function(e,t,r){"use strict";r.d(t,"a",(function(){return i})),r.d(t,"b",(function(){return n})),r("b775");var a=r("7562");function i(e){return a.a.post("/ApiManagerService/queryApiCategory",JSON.stringify(e))}function n(e){return a.a.post("/HttpApiService/queryApiList",e)}},3342:function(e,t,r){"use strict";var a=r("7562"),i=r("7aef"),n={findApiDoc:function(e){return a.a.post("/HttpApiService/findApiDoc",[e])},saveOrUpdateApiDocForXml:function(e,t){return i.a.post("/httpApi/saveOrUpdateApiDocForXml",e,{params:t})},updateApiDoc:function(e){return i.a.post("/httpApi/updateApiDoc",e)}};t.a=n},3935:function(e,t,r){"use strict";var a=r("c7eb"),i=(r("96cf"),r("1da1")),n=r("0e07"),s={name:"ErpPrincipal",props:{showPopover:{type:Boolean,default:!1},formDataPrincipal:{type:String,required:!0},placeholder:{type:String,default:"请输入负责人的ERP账号"},disabled:{type:Boolean,default:!1}},data:function(){return{dataPrincipal:"",principalVisible:!1,principalLoading:!1,principalOptionList:[]}},watch:{formDataPrincipal:{handler:function(e){this.dataPrincipal=e},immediate:!0}},methods:{findUser:function(){var e=Object(i.a)(Object(a.a)().mark((function e(t){var r,i=this;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={erp:t},e.next=3,n.a.findUser(r).catch((function(e){var t=e.data.message;throw t&&i.$message.error(t),new Error(t)}));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),findSupplierUserByErp:function(){var e=Object(i.a)(Object(a.a)().mark((function e(t){var r,i=this;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={erp:t},e.next=3,n.a.findSupplierUserByErp(r).catch((function(e){var t=e.data.message;throw t&&i.$message.error(t),new Error(e)}));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),changePrincipal:function(){var e=Object(i.a)(Object(a.a)().mark((function e(t){var r,i;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.$emit("update:formDataPrincipal",t),!this.showPopover){e.next=7;break}return e.next=4,this.findSupplierUserByErp(t);case 4:r=e.sent,i=r.data.data,this.principalVisible=!i;case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),remotePrincipal:function(){var e=Object(i.a)(Object(a.a)().mark((function e(t){var r,i;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(""===t){e.next=10;break}return this.principalLoading=!0,e.next=4,this.findUser(t);case 4:r=e.sent,i=r.data.data,this.principalOptionList=i,this.principalLoading=!1,e.next=11;break;case 10:this.principalOptionList=[];case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}},o=s,c=(r("7780"),r("2877")),p=Object(c.a)(o,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"erp-principal"},[r("el-popover",{attrs:{placement:"top-start",width:"280","popper-class":"erp-info-popover"},model:{value:e.principalVisible,callback:function(t){e.principalVisible=t},expression:"principalVisible"}},[r("div",{staticClass:"content-wrapper"},[r("i",{staticClass:"el-icon-info"}),r("p",{staticClass:"text"},[e._v(" 【"+e._s(e.formDataPrincipal)+"】不在您的团队下，为了不影响接口审批，建议去【个人中心】将该用户拉入您的团队。 ")])]),r("div",{staticClass:"button-wrapper"},[r("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){e.principalVisible=!1}}},[e._v("我知道了")])],1),r("span",{attrs:{slot:"reference"},slot:"reference"})]),r("el-select",{staticStyle:{width:"100%"},attrs:{loading:e.principalLoading,filterable:!0,remote:!0,"remote-method":e.remotePrincipal,placeholder:e.placeholder,disabled:e.disabled,"value-key":"userName","popper-class":"erp-info-dropdown__list"},on:{change:e.changePrincipal},model:{value:e.dataPrincipal,callback:function(t){e.dataPrincipal=t},expression:"dataPrincipal"}},e._l(e.principalOptionList,(function(t){return r("el-option",{key:t.userName,attrs:{label:t.userName,value:t.userName}},[r("div",{staticClass:"photo-wrapper"},[r("img",{staticStyle:{width:"32px",height:"32px"},attrs:{src:t.headImg}})]),r("div",{staticClass:"info-wrapper"},[r("p",{staticClass:"name"},[e._v(e._s(t.userName)+"（"+e._s(t.realName)+"）")]),r("p",{staticClass:"organization"},[e._v(" "+e._s(t.organizationFullName)+" ")])])])})),1)],1)}),[],!1,null,"1a467d82",null);t.a=p.exports},"3d85":function(e,t,r){"use strict";var a=(r("c5f6"),{name:"Steps",props:{titleList:{type:Array,default:function(){return[]}},active:{type:Number,required:!0}}}),i=(r("e75f"),r("2877")),n=Object(i.a)(a,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-steps",{staticClass:"steps",attrs:{active:e.active,"align-center":!0,"finish-status":"success"}},e._l(e.titleList,(function(e,t){return r("el-step",{key:t,attrs:{title:e}})})),1)}),[],!1,null,"443b202a",null);t.a=n.exports},"43b3":function(e,t,r){"use strict";var a={name:"Title",props:{text:{type:String,default:""}}},i=(r("b61a"),r("2877")),n=Object(i.a)(a,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"title"},[r("div",{staticClass:"title__icon"}),r("div",{staticClass:"title__text"},[e._v(e._s(e.text))])])}),[],!1,null,"3d118947",null);t.a=n.exports},"65f8":function(e,t,r){"use strict";r.r(t);var a=(r("c5f6"),r("c7eb")),i=(r("7f7f"),r("96cf"),r("1da1")),n=r("43b3"),s=r("3d85"),o=r("1667"),c=r("0e07"),p=r("3935"),u=r("328c"),l={components:{Title:n.a,Steps:s.a,ErpPrincipal:p.a},name:"PublishApi",data:function(){return{radio:1,progress:0,fullscreenLoading:!1,loading:!1,active:0,titleList:["确认API信息","填写API调用量","填写审批人ERP账号","提交发布请求成功"],apiCategoryForm:{name:"",remark:"",category:{}},apiCategoryRules:{category:[{required:!0,message:"API分类不能为空"}]},apiInfoForm:{tps:null,dailyCall:null},apiInfoRules:{tps:[{required:!0,message:"每秒调用量峰值不能为空"},{type:"number",min:1,max:1e8,message:"每日发送量峰值必须为1-100000000的整数值"}],dailyCall:[{required:!0,message:"每日调用量峰值不能为空"},{type:"number",min:1,max:1e8,message:"每日发送量峰值必须为1-100000000的整数值"}]},apiApproverForm:{approver:""},apiApproverRules:{approver:[{required:!0,message:"审批人ERP账号不能为空"}]},categoryOptions:[]}},created:function(){var e=Object(i.a)(Object(a.a)().mark((function e(){var t,r,i,n,s,o,c,p,u,l;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getApi();case 2:t=e.sent,r=t.data,i=r.name,n=r.remark,s=r.isOnline,o=r.categoryId,c=r.categoryName,p=r.tps,u=r.dailyCall,l=r.approver,this.apiCategoryForm.name=i,this.apiCategoryForm.remark=n,this.queryApiCategoryList(),1===s&&(this.apiCategoryForm.category={categoryId:o,categoryName:c},this.apiInfoForm.tps=p,this.apiInfoForm.dailyCall=u,this.apiApproverForm.approver=l||"");case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),methods:{nextStep:function(e){var t=this;this.$refs[e].validate((function(e){if(!e)return!1;t.active<3&&t.active++}))},previous:function(){this.active>0&&this.active--},submitForm:function(e){var t=this;this.$refs[e].validate((function(e){if(!e)return!1;t.fullscreenLoading=!0;var r={id:Number(t.$route.params.id),categoryId:Number(t.apiCategoryForm.category.categoryId),categoryName:t.apiCategoryForm.category.categoryName,tps:Number(t.apiInfoForm.tps),dailyCall:Number(t.apiInfoForm.dailyCall),approver:t.apiApproverForm.approver};o.a.postApi(r).then((function(e){t.fullscreenLoading=!1,t.active<3&&t.active++})).catch((function(e){t.fullscreenLoading=!1;var r=e.data.message;throw r&&t.$message.error(r),new Error(e)}))}))},gotoApistore:function(){window.location.href="/#/apiStore?interfaceType=http"},backApiList:function(){this.$router.push({path:"/apiManager/mobile"})},getApi:function(){var e=Object(i.a)(Object(a.a)().mark((function e(){var t,r,i=this;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.$route.params.id,r=[{id:t}],e.next=4,o.a.getApi(r).catch((function(e){var t=e.data.message;throw t&&i.$message.error(t),new Error(e)}));case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),queryApiCategoryList:function(){var e=this;Object(u.a)([{pageSize:1e4,pageNumb:1}]).then((function(t){var r=t.data.map((function(e){return{categoryId:e.id,categoryName:e.name}}));e.categoryOptions=r})).catch((function(e){}))},findUser:function(){var e=Object(i.a)(Object(a.a)().mark((function e(t){var r,i=this;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={erp:t},e.next=3,c.a.findUser(r).catch((function(e){var t=e.data.message;throw t&&i.$message.error(t),new Error(e)}));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}},f=l,d=(r("821f"),r("2877")),m=Object(d.a)(f,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"publish-api"},[r("Title",{attrs:{text:"发布API"}}),r("Steps",{attrs:{active:e.active,titleList:e.titleList}}),r("div",{staticClass:"form-container"},[r("div",{directives:[{name:"show",rawName:"v-show",value:0===e.active,expression:"active === 0"}]},[r("p",{staticClass:"title"},[e._v("请选择API分类")]),r("p",{staticClass:"title"},[e._v("API在API仓库中，将按照选择的API分类展示")]),r("div",{staticClass:"form-content"},[r("el-form",{ref:"apiCategoryForm",attrs:{rules:e.apiCategoryRules,model:e.apiCategoryForm,"label-width":"120px"}},[r("el-form-item",{attrs:{label:"中文名称"}},[r("span",[e._v(e._s(e.apiCategoryForm.name))])]),r("el-form-item",{attrs:{label:"功能描述"}},[r("span",[e._v(e._s(e.apiCategoryForm.remark))])]),r("el-form-item",{attrs:{label:"API分类",prop:"category"}},[r("el-select",{staticStyle:{width:"100%"},attrs:{filterable:!0,placeholder:"请选择API分类","value-key":"categoryId"},model:{value:e.apiCategoryForm.category,callback:function(t){e.$set(e.apiCategoryForm,"category",t)},expression:"apiCategoryForm.category"}},e._l(e.categoryOptions,(function(e){return r("el-option",{key:e.categoryId,attrs:{label:e.categoryName,value:e}})})),1)],1)],1)],1),r("div",{staticClass:"footer"},[r("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.nextStep("apiCategoryForm")}}},[e._v("下一步")])],1)]),r("div",{directives:[{name:"show",rawName:"v-show",value:1===e.active,expression:"active === 1"}]},[r("p",{staticClass:"title"},[e._v("请填写API的每秒/日调用量峰值")]),r("p",{staticClass:"title"},[e._v("物流开放平台会参考调用量峰值，判断是否需要扩容")]),r("div",{staticClass:"form-content"},[r("el-form",{ref:"apiInfoForm",attrs:{rules:e.apiInfoRules,model:e.apiInfoForm,"label-width":"120px"}},[r("el-form-item",{attrs:{label:"每秒调用量峰值",prop:"tps"}},[r("el-input",{attrs:{placeholder:"请输入API的每秒调用量峰值"},model:{value:e.apiInfoForm.tps,callback:function(t){e.$set(e.apiInfoForm,"tps",e._n(t))},expression:"apiInfoForm.tps"}})],1),r("el-form-item",{attrs:{label:"每日调用量峰值",prop:"dailyCall"}},[r("el-input",{attrs:{placeholder:"请输入API的每日调用量峰值"},model:{value:e.apiInfoForm.dailyCall,callback:function(t){e.$set(e.apiInfoForm,"dailyCall",e._n(t))},expression:"apiInfoForm.dailyCall"}})],1)],1)],1),r("div",{staticClass:"footer"},[r("el-button",{on:{click:e.previous}},[e._v("上一步")]),r("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.nextStep("apiInfoForm")}}},[e._v("下一步")])],1)]),r("div",{directives:[{name:"show",rawName:"v-show",value:2===e.active,expression:"active === 2"}]},[r("p",{staticClass:"title"},[e._v("请填写指定的审批人ERP账号")]),r("p",{staticClass:"title"},[e._v("审批通过后，API发布内容生效")]),r("div",{staticClass:"form-content"},[r("el-form",{ref:"apiApproverForm",attrs:{rules:e.apiApproverRules,model:e.apiApproverForm,"label-width":"126px"}},[r("el-form-item",{attrs:{label:"审批人ERP账号",prop:"approver"}},[r("ErpPrincipal",{attrs:{formDataPrincipal:e.apiApproverForm.approver,placeholder:"审批人可在京ME流程中心审批"},on:{"update:formDataPrincipal":function(t){return e.$set(e.apiApproverForm,"approver",t)},"update:form-data-principal":function(t){return e.$set(e.apiApproverForm,"approver",t)}}})],1)],1)],1),r("div",{staticClass:"footer"},[r("el-button",{on:{click:e.previous}},[e._v("上一步")]),r("el-button",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.fullscreenLoading,expression:"fullscreenLoading",modifiers:{fullscreen:!0,lock:!0}}],attrs:{type:"primary"},on:{click:function(t){return e.submitForm("apiApproverForm")}}},[e._v("发布")])],1)]),r("div",{directives:[{name:"show",rawName:"v-show",value:3===e.active,expression:"active === 3"}]},[e._m(0),r("p",{staticClass:"success-title"},[e._v("提交成功")]),r("p",{staticClass:"success-tip"},[e._v("提醒审批人尽快审批吧，审批通过后发布内容生效")]),r("div",{staticClass:"footer"},[r("el-button",{on:{click:e.gotoApistore}},[e._v("去前台查看API")]),r("el-button",{attrs:{type:"primary"},on:{click:e.backApiList}},[e._v("继续管理API")])],1)])])],1)}),[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"submit-success"},[t("i",{staticClass:"el-icon-success"})])}],!1,null,"3ce037a7",null);t.default=m.exports},7562:function(e,t,r){"use strict";var a=r("c7eb"),i=(r("96cf"),r("1da1")),n=r("bc3a"),s=r.n(n),o=r("7a3a"),c=r("3cfb"),p=r("c24f"),u=r("2a53"),l=r("a78e"),f=r.n(l),d=!1,m=s.a.create({baseURL:window.env.gatewayApiDecoupling,withCredentials:!0,timeout:1e4,headers:{"LOP-DN":window.env.gatewayApiDecouplingLop,"Account-Type":Object(u.a)()?"erp":"passport","X-Requested-With":"XMLHttpRequest"}});function v(){return y.apply(this,arguments)}function y(){return y=Object(i.a)(Object(a.a)().mark((function e(){return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:c.a.dispatch("user/resetUser"),sessionStorage.setItem("store",JSON.stringify(c.a.state)),o.MessageBox.confirm("您的登录状态已失效，是否重新登录？","提示",{confirmButtonText:"登录",cancelButtonText:"不登录",type:"warning"}).then(Object(i.a)(Object(a.a)().mark((function e(){return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d=!1,e.next=3,Object(p.a)();case 3:if(!u.a){e.next=8;break}return e.next=6,c.a.dispatch("user/handleIntranetGetUserInfo");case 6:e.next=9;break;case 8:window.location.reload();case 9:case"end":return e.stop()}}),e)})))).catch((function(){d=!1}));case 3:case"end":return e.stop()}}),e)}))),y.apply(this,arguments)}m.interceptors.request.use((function(e){return e.headers.groupCode=f.a.get("groupCode")||"",e}),(function(e){return Promise.reject(e)})),m.interceptors.response.use((function(e){var t=e.status;if(e.data.error_response)return o.Message.error("服务异常"),Promise.reject(e);if(401===t||520===t)return d||(d=!0,v()),Promise.reject(e);if(e.data.response){var r=e.data.response,a=r.code,i=r.message;return 2e4===a?e.data.response:(10003===a||i&&o.Message.error(i),Promise.reject(e.data.response))}return Promise.reject(e)}),(function(e){var t=e.response.status;return e.response.data.error_response&&o.Message.error("服务异常"),401!==t&&520!==t||d||(d=!0,v()),Promise.reject(e.response)})),t.a=m},7780:function(e,t,r){"use strict";r("0be6")},"821f":function(e,t,r){"use strict";r("15d6")},"9f9e":function(e,t,r){},b61a:function(e,t,r){"use strict";r("2f6a")},e75f:function(e,t,r){"use strict";r("9f9e")}}]);