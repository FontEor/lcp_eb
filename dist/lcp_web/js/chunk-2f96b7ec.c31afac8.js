(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-2f96b7ec"],{"23bf":function(t,e,n){"use strict";var a=n("7aef"),r={getAuth:function(){return a.a.get("/user/getAuth")},findSecondDevProductList:function(){return a.a.get("/product/release/findSecondDevProductList")},queryVersionListByProductCode:function(t){return a.a.get("/sysVersion/queryHaveSpiReleaseVersionListByProductCode",{params:t})},findExistedAppList:function(t){return a.a.get("/app/findExistedAppList",{params:t})},addProductAppInfo:function(t){return a.a.post("/app/addProductAppInfo",t)},getAppBaseInfo:function(t){return a.a.get("/app/getAppBaseInfo",{params:t})},updateProductAppInfo:function(t){return a.a.post("/app/updateProductAppInfo",t)},queryList:function(t){return a.a.get("/spiInstance/queryList",{params:t})},enable:function(t){return a.a.post("/spiInstance/enable",t)},queryOperateLog:function(t){return a.a.get("/spiInstance/queryOperateLog".concat(t))},publishProductApp:function(t){return a.a.post("/app/publishProductApp",null,{params:t,timeout:2e4})},pushTenantList:function(t,e){return a.a.get("/spiInstance/pushTenantList".concat(e),{params:t})},pushTenant:function(t){return a.a.post("/spiInstance/pushTenant",t)},pushTenantRevoke:function(t){return a.a.post("/spiInstance/pushTenantRevoke".concat(t))},survivalCheck:function(t){return a.a.post("/spiInstance/survivalCheck".concat(t))},queryListAll:function(t){return a.a.get("/spiInstance/queryListAll",{params:t})},source:function(t){return a.a.get("/logSearch/spi/source",{params:t})},traceId:function(t){return a.a.get("/logSearch/spi/traceId",{params:t})}};e.a=r},"2f6a":function(t,e,n){},"3d85":function(t,e,n){"use strict";var a=(n("c5f6"),{name:"Steps",props:{titleList:{type:Array,default:function(){return[]}},active:{type:Number,required:!0}}}),r=(n("e75f"),n("2877")),i=Object(r.a)(a,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("el-steps",{staticClass:"steps",attrs:{active:t.active,"align-center":!0,"finish-status":"success"}},t._l(t.titleList,(function(t,e){return n("el-step",{key:e,attrs:{title:t}})})),1)}),[],!1,null,"443b202a",null);e.a=i.exports},"43b3":function(t,e,n){"use strict";var a={name:"Title",props:{text:{type:String,default:""}}},r=(n("b61a"),n("2877")),i=Object(r.a)(a,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"title"},[n("div",{staticClass:"title__icon"}),n("div",{staticClass:"title__text"},[t._v(t._s(t.text))])])}),[],!1,null,"3d118947",null);e.a=i.exports},"8c61":function(t,e,n){"use strict";n.r(e);var a=(n("7f7f"),n("c7eb")),r=(n("96cf"),n("1da1")),i=n("43b3"),s=n("3d85"),o=n("23bf"),c={name:"Publish",components:{Title:i.a,Steps:s.a},data:function(){return{id:parseInt(this.$route.params.id),type:this.$route.params.type,loading:!0,active:0,titleList:["确认基本信息","确认扩展点变更","完成"],confirmBasicInfoFormData:{},confirmBasicInfoFormRules:{name:[{required:!0,message:"请输入应用中文名称"},{min:2,max:20,message:"长度在2到20个字符"}],remark:[{required:!0,message:"请输入应用描述信息"},{min:10,max:200,message:"长度在10到200个字符"}]},extensionPointTableData:[],extensionPointTableList:[{prop:"spiName",label:"扩展点名称","min-width":"140"},{prop:"uri",label:"URI","min-width":"200"},{prop:"environment",label:"环境","min-width":"140"},{prop:"spiOperate",label:"操作内容","min-width":"100"}],debounceTimer:null,confirmPublishLoading:!1}},watch:{active:{handler:function(t){1===t&&this.queryExtensionPointChangeList()}}},computed:{computeConfirmPublishButtonText:function(){return this.confirmPublishLoading?"发布中":"确认发布"},computeAppClassificationText:function(){var t=this.confirmBasicInfoFormData,e=t.productCode,n=void 0===e?"":e,a=t.sysVersionName,r=void 0===a?"":a;return"".concat(n,"-").concat(r)}},methods:{getAppBaseInfo:function(){var t=Object(r.a)(Object(a.a)().mark((function t(){var e,n,r=this;return Object(a.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.id,n={id:e},t.next=4,o.a.getAppBaseInfo(n).catch((function(t){var e=t.data.message;throw e&&r.$message.error(e),new Error("getAppBaseInfo")}));case 4:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),queryOperateLog:function(){var t=Object(r.a)(Object(a.a)().mark((function t(){var e,n,r=this;return Object(a.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.confirmBasicInfoFormData.code,n=e,t.next=4,o.a.queryOperateLog(n).catch((function(t){var e=t.data.message;throw e&&r.$message.error(e),new Error("queryOperateLog")}));case 4:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),updateProductAppInfo:function(){var t=Object(r.a)(Object(a.a)().mark((function t(){var e,n,r,i,s,c=this;return Object(a.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.id,n=this.confirmBasicInfoFormData,r=n.name,i=n.remark,s={id:e,name:r,remark:i},t.abrupt("return",o.a.updateProductAppInfo(s).catch((function(t){var e=t.data.message;throw e&&c.$message.error(e),new Error("updateProductAppInfo")})));case 4:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),publishProductApp:function(){var t=Object(r.a)(Object(a.a)().mark((function t(){var e,n,r=this;return Object(a.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.id,n={id:e},t.next=4,o.a.publishProductApp(n).catch((function(t){var e=t.data.message;throw e&&r.$message.error(e),new Error("publishProductApp")}));case 4:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),formatEnvironmentText:function(t){if(!t&&0===t.length)return"";var e=this.$store.state.tools.dictionary;try{return t.map((function(t){return e.environment[t].value})).join("、")}catch(e){return t.join("、")||""}},formatSpiOperateText:function(t){var e=this.$store.state.tools.dictionary;try{return e.spiOperate[t].value}catch(e){return t||""}},queryAppBaseInfo:function(){var t=Object(r.a)(Object(a.a)().mark((function t(){var e,n,r,i,s,o,c,u;return Object(a.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.loading=!0,t.next=3,this.getAppBaseInfo().catch((function(){throw new Error("queryAppBaseInfo")}));case 3:if(e=t.sent,n=e.data.data,r=n.code,i=n.name,s=n.remark,o=n.productCode,c=n.sysVersionName,2===(u=n.status)||3===u){t.next=8;break}throw this.$message.error("当前应用状态异常，暂不可发布！"),new Error("queryAppBaseInfo status error");case 8:this.confirmBasicInfoFormData={code:r,name:i,remark:s,productCode:o,sysVersionName:c},this.loading=!1;case 10:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),handleBasicInfoNextStep:function(){var t=this;this.$refs.confirmBasicInfoForm.validate((function(e){if(!e)return!1;t.active=1}))},queryExtensionPointChangeList:function(){var t=Object(r.a)(Object(a.a)().mark((function t(){var e,n;return Object(a.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.queryOperateLog().catch((function(){throw new Error("queryExtensionPointChangeList")}));case 2:e=t.sent,n=e.data.data,this.extensionPointTableData=n||[];case 5:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),handleConfirmPublish:function(){var t=this;clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(Object(r.a)(Object(a.a)().mark((function e(){return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.confirmPublishLoading=!0,e.next=3,t.updateProductAppInfo().catch((function(){throw t.confirmPublishLoading=!1,new Error("handleConfirmPublish updateProductAppInfo")}));case 3:return e.next=5,t.publishProductApp().catch((function(){throw t.confirmPublishLoading=!1,new Error("handleConfirmPublish publishProductApp")}));case 5:t.active=2,t.$nextTick((function(){t.confirmPublishLoading=!1}));case 7:case"end":return e.stop()}}),e)}))),300)}},created:function(){this.queryAppBaseInfo()}},u=c,p=(n("d7473"),n("2877")),l=Object(p.a)(u,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"publish"},[n("Title",{attrs:{text:"应用发布"}}),n("Steps",{attrs:{active:t.active,titleList:t.titleList}}),n("div",{directives:[{name:"show",rawName:"v-show",value:0===t.active,expression:"active === 0"}],staticClass:"publish__main confirm-basic-info"},[n("p",{staticClass:"main__title"},[t._v("请确认基本信息")]),n("el-form",{ref:"confirmBasicInfoForm",staticClass:"confirm-basic-info__form",attrs:{"label-width":"120px",model:t.confirmBasicInfoFormData}},[n("el-form-item",{attrs:{label:"应用中文名称",prop:"name"}},[n("el-input",{staticStyle:{width:"100%"},attrs:{placeholder:"请输入应用中文名称"},model:{value:t.confirmBasicInfoFormData.name,callback:function(e){t.$set(t.confirmBasicInfoFormData,"name","string"==typeof e?e.trim():e)},expression:"confirmBasicInfoFormData.name"}})],1),n("el-form-item",{attrs:{label:"应用描述",prop:"remark"}},[n("el-input",{staticStyle:{width:"100%"},attrs:{type:"textarea",placeholder:"请输入应用描述"},model:{value:t.confirmBasicInfoFormData.remark,callback:function(e){t.$set(t.confirmBasicInfoFormData,"remark","string"==typeof e?e.trim():e)},expression:"confirmBasicInfoFormData.remark"}})],1),n("el-form-item",{attrs:{label:"应用分类"}},[n("span",[t._v(t._s(t.computeAppClassificationText))])])],1)],1),n("div",{directives:[{name:"show",rawName:"v-show",value:1===t.active,expression:"active === 1"}],staticClass:"publish__main publish-extension-point"},[n("p",{staticClass:"main__title"},[t._v("确认扩展点变更")]),n("el-table",{staticClass:"publish-extension-point__table",staticStyle:{width:"100%"},attrs:{height:"240","empty-text":"暂无变更记录",data:t.extensionPointTableData,"hide-empty-img":!0}},t._l(t.extensionPointTableList,(function(e){return n("el-table-column",{key:e.id,attrs:{prop:e.prop,label:e.label,"min-width":e["min-width"]},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row,r=e.column;return["environment"===r.property?n("span",[t._v(" "+t._s(t.formatEnvironmentText(a[r.property]))+" ")]):"spiOperate"===r.property?n("span",[t._v(" "+t._s(t.formatSpiOperateText(a[r.property]))+" ")]):n("span",[t._v(t._s(a[r.property]))])]}}],null,!0)})})),1)],1),n("div",{directives:[{name:"show",rawName:"v-show",value:2===t.active,expression:"active === 2"}],staticClass:"publish__main publish-success"},[n("i",{staticClass:"el-icon-success publish-success__icon"}),n("p",{staticClass:"main__title"},[t._v("发布成功")]),n("p",{staticClass:"main__tip"},[t._v("您可以继续管理应用系统，或查看发布的扩展点。")])]),n("div",{staticClass:"publish__button-wrapper"},[n("el-button",{directives:[{name:"show",rawName:"v-show",value:0===t.active,expression:"active === 0"}],attrs:{type:"primary"},on:{click:t.handleBasicInfoNextStep}},[t._v("下一步")]),n("div",{directives:[{name:"show",rawName:"v-show",value:1===t.active,expression:"active === 1"}],staticClass:"button-wrapper__inner"},[n("el-button",{on:{click:function(e){t.active=0}}},[t._v("上一步")]),n("el-button",{attrs:{loading:t.confirmPublishLoading,type:"primary"},on:{click:t.handleConfirmPublish}},[t._v(t._s(t.computeConfirmPublishButtonText))])],1),n("div",{directives:[{name:"show",rawName:"v-show",value:2===t.active,expression:"active === 2"}],staticClass:"publish__button-wrapper"},[n("el-button",{on:{click:function(e){return t.$router.replace({name:"AppManagerDetail",params:{id:t.id,type:t.type}})}}},[t._v("管理应用系统")]),n("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.$router.replace({name:"AppManagerDetail",params:{id:t.id,type:t.type},query:{tab:"configExtensionPoint"}})}}},[t._v("返回扩展点列表")])],1)],1)],1)}),[],!1,null,"3a548483",null);e.default=l.exports},"9f9e":function(t,e,n){},b61a:function(t,e,n){"use strict";n("2f6a")},b9b2:function(t,e,n){},d7473:function(t,e,n){"use strict";n("b9b2")},e75f:function(t,e,n){"use strict";n("9f9e")}}]);