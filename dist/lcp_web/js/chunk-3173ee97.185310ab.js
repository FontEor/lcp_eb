(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-3173ee97"],{"2f6a":function(t,e,r){},"328c":function(t,e,r){"use strict";r.d(e,"a",(function(){return i})),r.d(e,"b",(function(){return n})),r("b775");var a=r("7562");function i(t){return a.a.post("/ApiManagerService/queryApiCategory",JSON.stringify(t))}function n(t){return a.a.post("/HttpApiService/queryApiList",t)}},"3d85":function(t,e,r){"use strict";var a=(r("c5f6"),{name:"Steps",props:{titleList:{type:Array,default:function(){return[]}},active:{type:Number,required:!0}}}),i=(r("e75f"),r("2877")),n=Object(i.a)(a,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("el-steps",{staticClass:"steps",attrs:{active:t.active,"align-center":!0,"finish-status":"success"}},t._l(t.titleList,(function(t,e){return r("el-step",{key:e,attrs:{title:t}})})),1)}),[],!1,null,"443b202a",null);e.a=n.exports},"401bf":function(t,e,r){},"43b3":function(t,e,r){"use strict";var a={name:"Title",props:{text:{type:String,default:""}}},i=(r("b61a"),r("2877")),n=Object(i.a)(a,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"title"},[r("div",{staticClass:"title__icon"}),r("div",{staticClass:"title__text"},[t._v(t._s(t.text))])])}),[],!1,null,"3d118947",null);e.a=n.exports},"85a8":function(t,e,r){"use strict";r("401bf")},"9f9e":function(t,e,r){},b61a:function(t,e,r){"use strict";r("2f6a")},bd09:function(t,e,r){"use strict";r.r(e);var a=(r("7f7f"),r("c5f6"),r("c7eb")),i=(r("96cf"),r("1da1")),n=r("43b3"),s=r("3d85"),o=r("328c"),c=r("fd48"),u={components:{Title:n.a,Steps:s.a},name:"PublishApi",data:function(){return{loading:!1,publishApiLoading:!0,active:0,titleList:["确认API信息","填写API调用量","填写发布原因","提交发布请求成功"],apiCategoryForm:{name:"",remark:"",category:null},apiCategoryRules:{category:[{required:!0,message:"请选择API分类"}]},apiInfoForm:{tps:null,dailyCall:null},apiInfoRules:{tps:[{required:!0,message:"请输入API的每秒调用量峰值"},{type:"number",min:1,max:1e8,message:"每日发送量峰值必须为1-100000000的整数值"}],dailyCall:[{required:!0,message:"请输入API的每日调用量峰值"},{type:"number",message:"API的每日调用量峰值要求为数字值"},{type:"number",min:1,max:1e8,message:"每日发送量峰值必须为1-100000000的整数值"}]},apiApproverForm:{reason:""},apiApproverRules:{reason:[{required:!0,message:"请输入发布原因"},{max:200,message:"最多输入200字"}]},categoryOptions:[],confirmPublishDebounceTimer:null}},methods:{queryOuterApiBaseInfo:function(){var t=Object(i.a)(Object(a.a)().mark((function t(){var e;return Object(a.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=[this.$route.params],t.next=3,c.a.ApiManagerService.queryOuterApiBaseInfo(e);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),verifyOuterApi:function(){var t=Object(i.a)(Object(a.a)().mark((function t(){var e;return Object(a.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=[this.$route.params],t.next=3,c.a.ApiManagerService.verifyOuterApi(e);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),publishOuterApi:function(){var t=Object(i.a)(Object(a.a)().mark((function t(){var e,r,i,n,s,o,u;return Object(a.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=Number(this.$route.params.id),r=this.apiApproverForm.reason,i=Number(this.apiCategoryForm.category.categoryId),n=this.apiCategoryForm.category.categoryName,s=Number(this.apiInfoForm.dailyCall),o=Number(this.apiInfoForm.tps),u=[{id:e,categoryId:i,categoryName:n,tps:o,dailyCall:s,reason:r}],t.next=9,c.a.OuterDomainApiService.publishOuterApi(u);case 9:return t.abrupt("return",t.sent);case 10:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),getApiBasicInfo:function(){var t=Object(i.a)(Object(a.a)().mark((function t(){var e,r,i,n;return Object(a.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.verifyOuterApi().catch((function(t){throw new Error("getApiBasicInfo verifyOuterApi, ".concat(t))}));case 2:return t.next=4,this.queryOuterApiBaseInfo().catch((function(){throw new Error("getApiBasicInfo queryOuterApiBaseInfo, ".concat(error))}));case 4:e=t.sent,r=e.data,i=r.name,n=r.intr,this.apiCategoryForm.name=i,this.apiCategoryForm.remark=n||"",this.publishApiLoading=!1;case 10:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),queryApiCategoryList:function(){var t=this;Object(o.a)([{pageSize:1e4,pageNumb:1}]).then((function(e){var r=e.data.map((function(t){return{categoryId:t.id,categoryName:t.name}}));t.categoryOptions=r})).catch((function(t){}))},nextStep:function(t){var e=this;this.$refs[t].validate((function(t){if(!t)return!1;e.active<3&&e.active++}))},handleConfirmPublish:function(t){var e=this;clearTimeout(this.confirmPublishDebounceTimer),this.confirmPublishDebounceTimer=setTimeout((function(){e.$refs[t].validate(function(){var r=Object(i.a)(Object(a.a)().mark((function r(i){return Object(a.a)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!i){r.next=8;break}return e.loading=!0,r.next=4,e.publishOuterApi().catch((function(t){throw e.loading=!1,new Error("handleConfirmPublish publishOuterApi, ".concat(t))}));case 4:e.loading=!1,e.nextStep(t),r.next=9;break;case 8:return r.abrupt("return",!1);case 9:case"end":return r.stop()}}),r)})));return function(t){return r.apply(this,arguments)}}())}),300)}},created:function(){var t=Object(i.a)(Object(a.a)().mark((function t(){return Object(a.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.getApiBasicInfo(),this.queryApiCategoryList();case 2:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},p=u,l=(r("85a8"),r("2877")),f=Object(l.a)(p,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"publish-api"},[r("Title",{attrs:{text:"发布API"}}),r("Steps",{attrs:{active:t.active,titleList:t.titleList}}),r("div",{directives:[{name:"loading",rawName:"v-loading",value:t.publishApiLoading,expression:"publishApiLoading"}],staticClass:"form-container"},[r("div",{directives:[{name:"show",rawName:"v-show",value:0===t.active,expression:"active === 0"}]},[r("p",{staticClass:"title"},[t._v("请选择API分类")]),r("p",{staticClass:"title"},[t._v("API在API仓库中，将按照选择的API分类展示")]),r("div",{staticClass:"form-content"},[r("el-form",{ref:"apiCategoryForm",attrs:{rules:t.apiCategoryRules,model:t.apiCategoryForm,"label-width":"120px"}},[r("el-form-item",{attrs:{label:"中文名称"}},[r("span",[t._v(t._s(t.apiCategoryForm.name))])]),r("el-form-item",{attrs:{label:"功能描述"}},[r("span",[t._v(t._s(t.apiCategoryForm.remark))])]),r("el-form-item",{attrs:{label:"API分类",prop:"category"}},[r("el-select",{staticStyle:{width:"100%"},attrs:{filterable:!0,placeholder:"请选择API分类","value-key":"categoryId"},model:{value:t.apiCategoryForm.category,callback:function(e){t.$set(t.apiCategoryForm,"category",e)},expression:"apiCategoryForm.category"}},t._l(t.categoryOptions,(function(t){return r("el-option",{key:t.categoryId,attrs:{label:t.categoryName,value:t}})})),1)],1)],1)],1),r("div",{staticClass:"footer"},[r("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.nextStep("apiCategoryForm")}}},[t._v("下一步")])],1)]),r("div",{directives:[{name:"show",rawName:"v-show",value:1===t.active,expression:"active === 1"}]},[r("p",{staticClass:"title"},[t._v("请填写API的每秒/日调用量峰值")]),r("p",{staticClass:"title"},[t._v("物流开放平台会参考调用量峰值，判断是否需要扩容")]),r("div",{staticClass:"form-content"},[r("el-form",{ref:"apiInfoForm",attrs:{rules:t.apiInfoRules,model:t.apiInfoForm,"label-width":"120px"}},[r("el-form-item",{attrs:{label:"每秒调用量峰值",prop:"tps"}},[r("el-input",{attrs:{placeholder:"请输入API的每秒调用量峰值"},model:{value:t.apiInfoForm.tps,callback:function(e){t.$set(t.apiInfoForm,"tps",t._n(e))},expression:"apiInfoForm.tps"}})],1),r("el-form-item",{attrs:{label:"每日调用量峰值",prop:"dailyCall"}},[r("el-input",{attrs:{placeholder:"请输入API的每日调用量峰值"},model:{value:t.apiInfoForm.dailyCall,callback:function(e){t.$set(t.apiInfoForm,"dailyCall",t._n(e))},expression:"apiInfoForm.dailyCall"}})],1)],1)],1),r("div",{staticClass:"footer"},[r("el-button",{on:{click:function(e){t.active=0}}},[t._v("上一步")]),r("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.nextStep("apiInfoForm")}}},[t._v("下一步")])],1)]),r("div",{directives:[{name:"show",rawName:"v-show",value:2===t.active,expression:"active === 2"}]},[r("div",{staticClass:"form-content"},[r("el-form",{ref:"apiApproverForm",attrs:{rules:t.apiApproverRules,model:t.apiApproverForm,"label-width":"0px"}},[r("el-form-item",{attrs:{prop:"reason"}},[r("el-input",{attrs:{rows:5,type:"textarea",placeholder:"请填写本次发布的原因，如快递回传业务，新增XX字段用于回传XX内容给外部客户。"},model:{value:t.apiApproverForm.reason,callback:function(e){t.$set(t.apiApproverForm,"reason",e)},expression:"apiApproverForm.reason"}})],1)],1)],1),r("div",{staticClass:"footer"},[r("el-button",{on:{click:function(e){t.active=1}}},[t._v("上一步")]),r("el-button",{attrs:{loading:t.loading,type:"primary"},on:{click:function(e){return t.handleConfirmPublish("apiApproverForm")}}},[t._v("发布")])],1)]),r("div",{directives:[{name:"show",rawName:"v-show",value:3===t.active,expression:"active === 3"}]},[t._m(0),r("p",{staticClass:"success-title"},[t._v("提交成功")]),t._m(1),r("p",{staticClass:"success-tip"},[t._v("审批通过后发布内容生效。")]),r("div",{staticClass:"footer"},[r("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.$router.push({name:"ApiManagerPassBackDetail",params:t.$route.params})}}},[t._v("继续管理API")])],1)])])],1)}),[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"submit-success"},[e("i",{staticClass:"el-icon-success"})])},function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("p",{staticClass:"success-tip"},[t._v(" 您可联系"),r("a",{attrs:{href:"timline://chat/?topin=zhangjuzheng3"}},[t._v("zhangjuzheng3")]),t._v("或"),r("a",{attrs:{href:"timline://chat/?topin=dongguojun1"}},[t._v("dongguojun1")]),t._v("提醒审批。 ")])}],!1,null,"b47a4394",null);e.default=f.exports},e75f:function(t,e,r){"use strict";r("9f9e")}}]);