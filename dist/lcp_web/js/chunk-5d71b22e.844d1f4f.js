(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-5d71b22e"],{2350:function(t,e,a){"use strict";a.r(e);var i=(a("7f7f"),a("c7eb")),n=(a("a481"),a("96cf"),a("1da1")),r=a("43b3"),s=a("3d85"),o=a("6f81"),c=a("94a8"),u=a.n(c),l={name:"Publish",components:{Title:r.a,Steps:s.a},data:function(){return{id:this.$route.params.id,productCode:"",loading:!0,isSecondaryDevelopment:!1,active:0,titleList:["确认基本信息","完善使用手册","确认扩展点变更","完成"],confirmBasicInfoFormData:{},addDocument:u.a,extensionPointTableData:[],extensionPointTableList:[{prop:"spiName",label:"扩展点名称","min-width":"140"},{prop:"uri",label:"URI","min-width":"200"},{prop:"environment",label:"环境","min-width":"140"},{prop:"spiOperate",label:"操作内容","min-width":"100"}],debounceTimer:null,confirmPublishLoading:!1}},watch:{active:{handler:function(t){2===t&&this.queryExtensionPointChangeList()}}},computed:{computeConfirmPublishButtonText:function(){return this.confirmPublishLoading?"发布中":"确认发布"}},methods:{dry:function(){var t=Object(n.a)(Object(i.a)().mark((function t(){var e,a,n=this;return Object(i.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.id,a={id:e},t.next=4,o.a.dry(a).catch((function(t){var e=t.data.message;throw e&&n.$message.error(e),setTimeout((function(){n.$router.replace({name:"SoftwareSystem"})}),2e3),new Error("dry")}));case 4:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),product:function(){var t=Object(n.a)(Object(i.a)().mark((function t(){var e,a,n=this;return Object(i.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.id,a={id:e},t.next=4,o.a.product(a).catch((function(t){var e=t.data.message;throw e&&n.$message.error(e),new Error("product")}));case 4:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),queryOperateLog:function(){var t=Object(n.a)(Object(i.a)().mark((function t(){var e,a=this;return Object(i.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.productCode,t.next=3,o.a.queryOperateLog(e).catch((function(t){var e=t.data.message;throw e&&a.$message.error(e),new Error("queryOperateLog")}));case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),publish:function(){var t=Object(n.a)(Object(i.a)().mark((function t(){var e,a,n=this;return Object(i.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.id,a={id:e},t.next=4,o.a.publish(a).catch((function(t){var e=t.data.message;throw e&&n.$message.error(e),new Error("publish")}));case 4:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),formatConfirmBasicInfoFormScope:function(t){return{1:"外网",2:"内网"}[t]||""},formatEnvironmentText:function(t){if(!t&&0===t.length)return"";var e=this.$store.state.tools.dictionary;try{return t.map((function(t){return e.environment[t].value})).join("、")}catch(e){return t.join("、")||""}},formatSpiOperateText:function(t){var e=this.$store.state.tools.dictionary;try{return e.spiOperate[t].value}catch(e){return t||""}},checkSoftwareSystemPublishable:function(){var t=Object(n.a)(Object(i.a)().mark((function t(){return Object(i.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.loading=!0,t.next=3,this.dry().catch((function(){throw new Error("checkSoftwareSystemPublishable")}));case 3:this.loading=!1;case 4:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),querySoftwareSystemBasicInfo:function(){var t=Object(n.a)(Object(i.a)().mark((function t(){var e,a,n,r,s,o,c,u;return Object(i.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.product().catch((function(){throw new Error("querySoftwareSystemBasicInfo")}));case 2:e=t.sent,a=e.data.data,n=a.code,r=a.name,s=a.scope,o=a.description,c=a.secondaryDevelopment,u=void 0===c?"0":c,this.productCode=n,this.isSecondaryDevelopment=Boolean(parseInt(u)),this.confirmBasicInfoFormData={name:r,scope:s,description:o},this.isSecondaryDevelopment||(this.titleList=["确认基本信息","完善使用手册","完成"]);case 8:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),queryExtensionPointChangeList:function(){var t=Object(n.a)(Object(i.a)().mark((function t(){var e,a;return Object(i.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.queryOperateLog().catch((function(){throw new Error("queryExtensionPointChangeList")}));case 2:e=t.sent,a=e.data.data,this.extensionPointTableData=a||[];case 5:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),handleConfirmPublish:function(){var t=this;clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(Object(n.a)(Object(i.a)().mark((function e(){return Object(i.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.confirmPublishLoading=!0,e.next=3,t.publish().catch((function(){throw t.confirmPublishLoading=!1,new Error("handleConfirmPublish")}));case 3:t.active=t.isSecondaryDevelopment?3:2,t.$nextTick((function(){t.confirmPublishLoading=!1}));case 5:case"end":return e.stop()}}),e)}))),300)}},created:function(){this.querySoftwareSystemBasicInfo(),this.checkSoftwareSystemPublishable().catch((function(){throw new Error("created checkSoftwareSystemPublishable")}))}},p=l,m=(a("5c31"),a("2877")),v=Object(m.a)(p,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"publish"},[a("Title",{attrs:{text:"软件系统发布"}}),a("Steps",{attrs:{active:t.active,titleList:t.titleList}}),t.isSecondaryDevelopment?[a("div",{directives:[{name:"show",rawName:"v-show",value:0===t.active,expression:"active === 0"}],staticClass:"publish__main confirm-basic-info"},[a("p",{staticClass:"main__title"},[t._v("请确认基本信息")]),a("p",{staticClass:"main__tip"},[t._v(" 此处填写的信息将直接展示给用户，以供用户了解和购买软件系统，请认真确认。 ")]),a("el-form",{staticClass:"confirm-basic-info__form",attrs:{"label-width":"100px",model:t.confirmBasicInfoFormData}},[a("el-form-item",{attrs:{label:"系统名称"}},[t._v(" "+t._s(t.confirmBasicInfoFormData.name)+" ")]),a("el-form-item",{attrs:{label:"发布范围"}},[t._v(" "+t._s(t.formatConfirmBasicInfoFormScope(t.confirmBasicInfoFormData.scope))+" ")]),a("el-form-item",{attrs:{label:"系统描述"}},[a("pre",{staticClass:"form__description"},[t._v("          "+t._s(t.confirmBasicInfoFormData.description)+"\n        ")])])],1)],1),a("div",{directives:[{name:"show",rawName:"v-show",value:1===t.active,expression:"active === 1"}],staticClass:"publish__main improve-manual"},[a("p",{staticClass:"main__title"},[t._v("完善使用手册")]),a("p",{staticClass:"main__tip"},[t._v(" 软件系统发布后，您仍可在使用手册页面逐一创建、发布文档，发布后，用户即可在物流开放平台查看文档。 ")]),a("div",{staticClass:"improve-manual__image"},[a("el-image",{attrs:{src:t.addDocument,"preview-src-list":[t.addDocument]}})],1)]),a("div",{directives:[{name:"show",rawName:"v-show",value:2===t.active,expression:"active === 2"}],staticClass:"publish__main publish-extension-point"},[a("p",{staticClass:"main__title"},[t._v("确认扩展点变更")]),a("el-table",{staticClass:"publish-extension-point__table",staticStyle:{width:"100%"},attrs:{height:"240","empty-text":"暂无变更记录",data:t.extensionPointTableData,"hide-empty-img":!0}},t._l(t.extensionPointTableList,(function(e){return a("el-table-column",{key:e.id,attrs:{prop:e.prop,label:e.label,"min-width":e["min-width"]},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.row,n=e.column;return["environment"===n.property?a("span",[t._v(" "+t._s(t.formatEnvironmentText(i[n.property]))+" ")]):"spiOperate"===n.property?a("span",[t._v(" "+t._s(t.formatSpiOperateText(i[n.property]))+" ")]):a("span",[t._v(t._s(i[n.property]))])]}}],null,!0)})})),1)],1),a("div",{directives:[{name:"show",rawName:"v-show",value:3===t.active,expression:"active === 3"}],staticClass:"publish__main publish-success"},[a("i",{staticClass:"el-icon-success publish-success__icon"}),a("p",{staticClass:"main__title"},[t._v("发布成功")]),a("p",{staticClass:"main__tip"},[t._v(" 您可以继续编写使用手册、开发者资源，或管理软件系统。 ")])]),a("div",{staticClass:"publish__button-wrapper"},[a("el-button",{directives:[{name:"show",rawName:"v-show",value:0===t.active,expression:"active === 0"}],attrs:{type:"primary"},on:{click:function(e){t.active=1}}},[t._v("下一步")]),a("div",{directives:[{name:"show",rawName:"v-show",value:1===t.active,expression:"active === 1"}],staticClass:"button-wrapper__inner"},[a("el-button",{on:{click:function(e){t.active=0}}},[t._v("上一步")]),a("el-button",{attrs:{type:"primary"},on:{click:function(e){t.active=2}}},[t._v("下一步")])],1),a("div",{directives:[{name:"show",rawName:"v-show",value:2===t.active,expression:"active === 2"}],staticClass:"button-wrapper__inner"},[a("el-button",{on:{click:function(e){t.active=1}}},[t._v("上一步")]),a("el-button",{attrs:{loading:t.confirmPublishLoading,type:"primary"},on:{click:t.handleConfirmPublish}},[t._v(t._s(t.computeConfirmPublishButtonText))])],1),a("div",{directives:[{name:"show",rawName:"v-show",value:3===t.active,expression:"active === 3"}],staticClass:"publish__button-wrapper"},[a("el-button",{on:{click:function(e){return t.$router.replace({name:"SoftwareSystemDetail",params:{id:t.id},query:{tabName:"developerResource"}})}}},[t._v("添加开发者资源")]),a("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.$router.replace({name:"SoftwareSystemDetail",params:{id:t.id}})}}},[t._v("管理软件系统")])],1)],1)]:[a("div",{directives:[{name:"show",rawName:"v-show",value:0===t.active,expression:"active === 0"}],staticClass:"publish__main confirm-basic-info"},[a("p",{staticClass:"main__title"},[t._v("请确认基本信息")]),a("p",{staticClass:"main__tip"},[t._v(" 此处填写的信息将直接展示给用户，以供用户了解和购买软件系统，请认真确认。 ")]),a("el-form",{staticClass:"confirm-basic-info__form",attrs:{"label-width":"100px",model:t.confirmBasicInfoFormData}},[a("el-form-item",{attrs:{label:"系统名称"}},[t._v(" "+t._s(t.confirmBasicInfoFormData.name)+" ")]),a("el-form-item",{attrs:{label:"发布范围"}},[t._v(" "+t._s(t.formatConfirmBasicInfoFormScope(t.confirmBasicInfoFormData.scope))+" ")]),a("el-form-item",{attrs:{label:"系统描述"}},[a("pre",{staticClass:"form__description"},[t._v("          "+t._s(t.confirmBasicInfoFormData.description)+"\n        ")])])],1)],1),a("div",{directives:[{name:"show",rawName:"v-show",value:1===t.active,expression:"active === 1"}],staticClass:"publish__main improve-manual"},[a("p",{staticClass:"main__title"},[t._v("完善使用手册")]),a("p",{staticClass:"main__tip"},[t._v(" 软件系统发布后，您仍可在使用手册页面逐一创建、发布文档，发布后，用户即可在物流开放平台查看文档。 ")]),a("div",{staticClass:"improve-manual__image"},[a("el-image",{attrs:{src:t.addDocument,"preview-src-list":[t.addDocument]}})],1)]),a("div",{directives:[{name:"show",rawName:"v-show",value:2===t.active,expression:"active === 2"}],staticClass:"publish__main publish-success"},[a("i",{staticClass:"el-icon-success publish-success__icon"}),a("p",{staticClass:"main__title"},[t._v("发布成功")]),a("p",{staticClass:"main__tip"},[t._v(" 您可以继续编写使用手册、开发者资源，或管理软件系统。 ")])]),a("div",{staticClass:"publish__button-wrapper"},[a("el-button",{directives:[{name:"show",rawName:"v-show",value:0===t.active,expression:"active === 0"}],attrs:{type:"primary"},on:{click:function(e){t.active=1}}},[t._v("下一步")]),a("div",{directives:[{name:"show",rawName:"v-show",value:1===t.active,expression:"active === 1"}],staticClass:"button-wrapper__inner"},[a("el-button",{on:{click:function(e){t.active=0}}},[t._v("上一步")]),a("el-button",{attrs:{loading:t.confirmPublishLoading,type:"primary"},on:{click:t.handleConfirmPublish}},[t._v(t._s(t.computeConfirmPublishButtonText))])],1),a("div",{directives:[{name:"show",rawName:"v-show",value:2===t.active,expression:"active === 2"}],staticClass:"publish__button-wrapper"},[a("el-button",{on:{click:function(e){return t.$router.replace({name:"SoftwareSystemDetail",params:{id:t.id}})}}},[t._v("管理软件系统")]),a("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.$router.replace({name:"SoftwareSystemDetail",params:{id:t.id},query:{tabName:"manual"}})}}},[t._v("编写使用手册")])],1)],1)]],2)}),[],!1,null,"2ebb2d38",null);e.default=v.exports},"245b":function(t,e,a){},"2f6a":function(t,e,a){},"3d85":function(t,e,a){"use strict";var i=(a("c5f6"),{name:"Steps",props:{titleList:{type:Array,default:function(){return[]}},active:{type:Number,required:!0}}}),n=(a("e75f"),a("2877")),r=Object(n.a)(i,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-steps",{staticClass:"steps",attrs:{active:t.active,"align-center":!0,"finish-status":"success"}},t._l(t.titleList,(function(t,e){return a("el-step",{key:e,attrs:{title:t}})})),1)}),[],!1,null,"443b202a",null);e.a=r.exports},"43b3":function(t,e,a){"use strict";var i={name:"Title",props:{text:{type:String,default:""}}},n=(a("b61a"),a("2877")),r=Object(n.a)(i,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"title"},[a("div",{staticClass:"title__icon"}),a("div",{staticClass:"title__text"},[t._v(t._s(t.text))])])}),[],!1,null,"3d118947",null);e.a=r.exports},"5c31":function(t,e,a){"use strict";a("245b")},"94a8":function(t,e,a){t.exports=a.p+"img/addDocument.b403b786.gif"},"9f9e":function(t,e,a){},b61a:function(t,e,a){"use strict";a("2f6a")},e75f:function(t,e,a){"use strict";a("9f9e")}}]);