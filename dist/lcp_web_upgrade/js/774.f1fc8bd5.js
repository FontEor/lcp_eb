"use strict";(self["webpackChunklcp_web_upgrade"]=self["webpackChunklcp_web_upgrade"]||[]).push([[774],{7774:function(e,r,o){o.r(r),o.d(r,{default:function(){return y}});o(7658);var a=o(3396),l=o(4870),t=o(8137),p=o(7178);const d=e=>((0,a.dD)("data-v-0bac1fb7"),e=e(),(0,a.Cn)(),e),n={class:"work-order-description"},i={class:"work-order-description__form"},u=d((()=>(0,a._)("span",{class:"form__upload-desc"},"最多可以上传5个附件",-1))),m=d((()=>(0,a._)("div",{class:"el-upload__tip"}," 附件支持txt、pdf、jpg、jpeg、png格式，单个文件大小不超过10MB。 ",-1))),s={class:"work-order-description__footer"},c={class:"footer__button"};var w=(0,a.aZ)({__name:"index",props:{workOrderTypeCode:null},emits:["update:active"],setup(e,{emit:r}){const o=e,d=(0,l.iH)("right"),w=(0,l.iH)([]),{workOrderTypeCode:f}=(0,l.BK)(o),_={label:"typeName",value:"code",emitPath:!1},y=(0,l.iH)(),k=(0,l.qj)({workOrderTypeCode:[{required:!0,message:"请选择工单类型"}],workOrderContent:[{required:!0,message:"请输入问题描述"}]});let b=[];const g=(0,l.qj)({workOrderTypeCode:f,appKey:"",msgApiInfo:"",orderNumberInfo:"",workOrderContent:"",appendices:[]}),h=async e=>{e&&await e.validate((async(e,o)=>{if(e){const{workOrderTypeCode:e,appKey:o,msgApiInfo:a,orderNumberInfo:l,workOrderContent:p}=g,d={workOrderTypeCode:e,appKey:o,msgApiInfo:a,orderNumberInfo:l,workOrderContent:p,appendices:b};await t.i.createWorkOrder(d).catch((e=>{throw new Error})),r("update:active",3)}else console.log("error submit!",o)}))},v=()=>{r("update:active",1)},C=()=>{p.z8.warning("最多可上传5个附件")},O=e=>{b=b.filter((r=>r.attName!==e.name))},W=(e,r)=>{const o=e.size/1024/1024<10;if(!o)return p.z8.error("上传文件大小不能超过 10MB!"),!1;let a=e.name.lastIndexOf("."),l=e.name.substr(a+1,e.name.length);return-1===["txt","pdf","jpg","jpeg","png"].indexOf(l.toLowerCase())?(p.z8.error("请上传txt、pdf、jpg、jpeg、png格式的附件！"),!1):void 0},I=async e=>{const{file:r}=e,o=new FormData;o.append("file",r);const a=await t.i.uploadFile(o).catch((e=>{throw new Error}));b.push({attName:a.name,fileCode:a.code})};async function V(){const e=await t.i.fetchTypeList().catch((e=>{throw e}));w.value=Array.isArray(e)?e:[]}return(0,a.bv)((()=>{V()})),(e,r)=>{const o=(0,a.up)("el-cascader"),l=(0,a.up)("el-form-item"),t=(0,a.up)("el-input"),p=(0,a.up)("el-button"),f=(0,a.up)("el-upload"),b=(0,a.up)("el-form");return(0,a.wg)(),(0,a.iD)("div",n,[(0,a._)("div",i,[(0,a.Wm)(b,{ref_key:"workOrderFormRef",ref:y,"label-position":d.value,rules:k,"label-width":"100px",model:g},{default:(0,a.w5)((()=>[(0,a.Wm)(l,{label:"工单类型",prop:"workOrderTypeCode"},{default:(0,a.w5)((()=>[(0,a.Wm)(o,{style:{width:"100%"},modelValue:g.workOrderTypeCode,"onUpdate:modelValue":r[0]||(r[0]=e=>g.workOrderTypeCode=e),props:_,options:w.value,filterable:""},null,8,["modelValue","options"])])),_:1}),(0,a.Wm)(l,{label:"API/消息",prop:"msgApiInfo"},{default:(0,a.w5)((()=>[(0,a.Wm)(t,{modelValue:g.msgApiInfo,"onUpdate:modelValue":r[1]||(r[1]=e=>g.msgApiInfo=e),placeholder:"如涉及API或消息，请选择path路径或消息名，如：/ecap/v1/orders/precheck下单前置校验",maxlength:"150","show-word-limit":""},null,8,["modelValue"])])),_:1}),(0,a.Wm)(l,{label:"单号信息",prop:"orderNumberInfo"},{default:(0,a.w5)((()=>[(0,a.Wm)(t,{modelValue:g.orderNumberInfo,"onUpdate:modelValue":r[2]||(r[2]=e=>g.orderNumberInfo=e),placeholder:"如涉及具体单号，请输入运单号/订单号",maxlength:"100","show-word-limit":""},null,8,["modelValue"])])),_:1}),(0,a.Wm)(l,{label:"AppKey",prop:"appKey"},{default:(0,a.w5)((()=>[(0,a.Wm)(t,{modelValue:g.appKey,"onUpdate:modelValue":r[3]||(r[3]=e=>g.appKey=e),maxlength:"32","show-word-limit":"",placeholder:"如已有AppKey，请输入AppKey，可去【控制台-应用管理-管理-概览】获取，AppKey为32位"},null,8,["modelValue"])])),_:1}),(0,a.Wm)(l,{label:"问题描述",prop:"workOrderContent"},{default:(0,a.w5)((()=>[(0,a.Wm)(t,{modelValue:g.workOrderContent,"onUpdate:modelValue":r[4]||(r[4]=e=>g.workOrderContent=e),maxlength:"500","show-word-limit":"",type:"textarea",placeholder:"请尽量详细的描述问题，包括不限于问题场景+具体问题+相关参数（如调用时间、相关报文、公司名称、页面链接）等，详细的信息可以帮助我们更快的解决问题"},null,8,["modelValue"])])),_:1}),(0,a.Wm)(l,{label:"附件上传",prop:"appendices"},{default:(0,a.w5)((()=>[(0,a.Wm)(f,{multiple:"",accept:".txt,.pdf,.jpg,.jpeg,.png","before-upload":W,"http-request":I,"on-exceed":C,"on-remove":O,limit:5},{tip:(0,a.w5)((()=>[u,m])),default:(0,a.w5)((()=>[(0,a.Wm)(p,{type:"primary"},{default:(0,a.w5)((()=>[(0,a.Uk)("点击上传")])),_:1})])),_:1})])),_:1})])),_:1},8,["label-position","rules","model"])]),(0,a._)("div",s,[(0,a._)("div",c,[(0,a.Wm)(p,{onClick:v},{default:(0,a.w5)((()=>[(0,a.Uk)("上一步")])),_:1}),(0,a.Wm)(p,{type:"primary",onClick:r[5]||(r[5]=e=>h(y.value))},{default:(0,a.w5)((()=>[(0,a.Uk)("提交工单")])),_:1})])])])}}}),f=o(89);const _=(0,f.Z)(w,[["__scopeId","data-v-0bac1fb7"]]);var y=_}}]);
//# sourceMappingURL=774.f1fc8bd5.js.map